# quanta-trade [![GitHub Actions status |clojure-quant/quanta-trade](https://github.com/clojure-quant/quanta-trade/workflows/CI/badge.svg)](https://github.com/clojure-quant/quanta-trade/actions?workflow=CI)[![Clojars Project](https://img.shields.io/clojars/v/io.github.clojure-quant/quanta-trade.svg)](https://clojars.org/io.github.clojure-quant/quanta-trade)


## What is quanta-trade?

### trade-manager
- gets a entry/exit rule config.
- input is a stream of entry-signals
- is in contact with brokers (or simulated brokers)
- opens and closes positions based on the entry stream, the position-update-stream 
  and its rule-config.

### quanta.trade.report 
 - input is a list of open and closed positions ("roundtrips")
 - outputs
   - :roundtrip-ds  nav time-series (so how did the portfolio value develop over time) 
   - :metrics (like profit-factor and maximum drawdown) 

:roundtrip-ds

 | :entry-idx |          :entry-date | :entry-price |        :reason | :exit-idx |    :id |  :side | :qty |    :exit-price |  :asset |           :exit-date |      :fee | :volume-trading |    :cum-log |   :volume-exit |         :equity | :bars | :win? | :volume-entry |     :cum-prct |     :pl-log |            :pl |      :pl-gross |    :pl-prct |     :pl-points |     :cum-points |      :drawdown | :drawdown-prct |
|-----------:|----------------------|-------------:|----------------|----------:|--------|--------|-----:|---------------:|---------|----------------------|----------:|----------------:|------------:|---------------:|----------------:|------:|-------|--------------:|--------------:|------------:|---------------:|---------------:|------------:|---------------:|----------------:|---------------:|---------------:|
|          1 | 2022-08-06T23:59:59Z |     23177.58 |   :profit-prct |         2 | JiiuKn |  :long |  1.0 | 23409.35580000 | BTCUSDT | 2022-08-07T23:59:59Z |  92.71032 |  46586.93580000 |  0.00432137 | 23409.35580000 |  10139.06548000 |     1 |  true |      23177.58 |    0.60000000 |  0.00432137 |   139.06548000 |   231.77580000 |  0.60000000 |   231.77580000 |    231.77580000 |     0.00000000 |     0.00000000 |
|          4 | 2022-08-09T23:59:59Z |     23952.14 |   :profit-prct |         5 | Hl0kyB |  :long |  1.0 | 24191.66140000 | BTCUSDT | 2022-08-10T23:59:59Z |  95.80856 |  48143.80140000 |  0.00864275 | 24191.66140000 |  10282.77832000 |     1 |  true |      23952.14 |    1.20000000 |  0.00432137 |   143.71284000 |   239.52140000 |  0.60000000 |   239.52140000 |    471.29720000 |     0.00000000 |     0.00000000 |
|         19 | 2022-08-24T23:59:59Z |     21563.81 |   :profit-prct |        20 | 2OVcLi | :short |  1.0 | 21350.30693069 | BTCUSDT | 2022-08-25T23:59:59Z |  86.25524 |  42914.11693069 |  0.01296412 | 21350.30693069 |  10410.02614931 |     1 |  true |      21563.81 |    1.79009901 |  0.00432137 |   127.24782931 |   213.50306931 |  0.59009901 |   213.50306931 |    684.80026931 |     0.00000000 |     0.00000000 |
|         26 | 2022-08-31T23:59:59Z |     20133.28 |   :profit-prct |        27 | AgaeYS | :short |  1.0 | 19933.94059406 | BTCUSDT | 2022-09-01T23:59:59Z |  80.53312 |  40067.22059406 |  0.01728550 | 19933.94059406 |  10528.83243525 |     1 |  true |      20133.28 |    2.38019802 |  0.00432137 |   118.80628594 |   199.33940594 |  0.59009901 |   199.33940594 |    884.13967525 |     0.00000000 |     0.00000000 |
|         29 | 2022-09-03T23:59:59Z |     20001.27 |   :profit-prct |        30 | c7SLZY | :short |  1.0 | 19803.23762376 | BTCUSDT | 2022-09-04T23:59:59Z |  80.00508 |  39804.50762376 |  0.02160687 | 19803.23762376 |  10646.85973149 |     1 |  true |      20001.27 |    2.97029703 |  0.00432137 |   118.02729624 |   198.03237624 |  0.59009901 |   198.03237624 |   1082.17205149 |     0.00000000 |     0.00000000 |
|         34 | 2022-09-08T23:59:59Z |     21364.44 |   :profit-prct |        35 | NYRiCI |  :long |  1.0 | 21578.08440000 | BTCUSDT | 2022-09-09T23:59:59Z |  85.45776 |  42942.52440000 |  0.02592824 | 21578.08440000 |  10775.04637149 |     1 |  true |      21364.44 |    3.57029703 |  0.00432137 |   128.18664000 |   213.64440000 |  0.60000000 |   213.64440000 |   1295.81645149 |     0.00000000 |     0.00000000 |
|         42 | 2022-09-16T23:59:59Z |     20112.00 |   :profit-prct |        43 | jpouQ9 | :short |  1.0 | 19912.87128713 | BTCUSDT | 2022-09-17T23:59:59Z |  80.44800 |  40024.87128713 |  0.03024962 | 19912.87128713 |  10893.72708436 |     1 |  true |      20112.00 |    4.16039604 |  0.00432137 |   118.68071287 |   199.12871287 |  0.59009901 |   199.12871287 |   1494.94516436 |     0.00000000 |     0.00000000 |
|         47 | 2022-09-21T23:59:59Z |     19397.79 |   :profit-prct |        48 | naXT67 | :short |  1.0 | 19205.73267327 | BTCUSDT | 2022-09-22T23:59:59Z |  77.59116 |  38603.52267327 |  0.03457099 | 19205.73267327 |  11008.19325109 |     1 |  true |      19397.79 |    4.75049505 |  0.00432137 |   114.46616673 |   192.05732673 |  0.59009901 |   192.05732673 |   1687.00249109 |     0.00000000 |     0.00000000 |
|         51 | 2022-09-25T23:59:59Z |     19225.70 |     :stop-prct |        52 | tr28p9 | :short |  1.0 | 19610.21400000 | BTCUSDT | 2022-09-26T23:59:59Z |  76.90280 |  38835.91400000 |  0.02597082 | 19610.21400000 |  10546.77645109 |     1 | false |      19225.70 |    2.35049505 | -0.00860017 |  -461.41680000 |  -384.51400000 | -2.40000000 |  -384.51400000 |   1302.48849109 |   461.41680000 |     4.37495572 |
|         53 | 2022-09-27T23:59:59Z |     19413.50 |     :stop-prct |        54 | JZ5xVX |  :long |  1.0 | 19032.84313725 | BTCUSDT | 2022-09-28T23:59:59Z |  77.65400 |  38446.34313725 |  0.01737065 | 19032.84313725 |  10088.46558834 |     1 | false |      19413.50 |   -0.01028926 | -0.00860017 |  -458.31086275 |  -380.65686275 | -2.36078431 |  -380.65686275 |    921.83162834 |   919.72766275 |     9.11662586 |
|        ... |                  ... |          ... |            ... |       ... |    ... |    ... |  ... |            ... |     ... |                  ... |       ... |             ... |         ... |            ... |             ... |   ... |   ... |           ... |           ... |         ... |            ... |            ... |         ... |            ... |             ... |            ... |            ... |
|        741 | 2024-08-15T23:59:59Z |     58879.89 |     :stop-prct |       743 | 83g-za | :short |  1.0 | 60057.48780000 | BTCUSDT | 2024-08-17T23:59:59Z | 235.51956 | 118937.37780000 | -0.23685090 | 60057.48780000 | -26295.09318417 |     2 | false |      58879.89 | -101.83206744 | -0.00860017 | -1413.11736000 | -1177.59780000 | -2.40000000 | -1177.59780000 | -19333.81994417 | 37303.28643526 |  -141.86405872 |
|        744 | 2024-08-18T23:59:59Z |     59439.59 |     :stop-prct |       745 | YGqzWd | :short |  1.0 | 60628.38180000 | BTCUSDT | 2024-08-19T23:59:59Z | 237.75836 | 120067.97180000 | -0.24545107 | 60628.38180000 | -27721.64334417 |     1 | false |      59439.59 | -104.23206744 | -0.00860017 | -1426.55016000 | -1188.79180000 | -2.40000000 | -1188.79180000 | -20522.61174417 | 38729.83659526 |  -139.70974272 |
|        746 | 2024-08-20T23:59:59Z |     61152.67 |     :stop-prct |       747 | QdaidL |  :long |  1.0 | 59953.59803922 | BTCUSDT | 2024-08-21T23:59:59Z | 244.61068 | 121106.26803922 | -0.25405124 | 59953.59803922 | -29165.32598495 |     1 | false |      61152.67 | -106.59285175 | -0.00860017 | -1443.68264078 | -1199.07196078 | -2.36078431 | -1199.07196078 | -21721.68370495 | 40173.51923604 |  -137.74411182 |
|        758 | 2024-09-01T23:59:59Z |     59142.75 |   :profit-prct |       759 | VFuaZx | :short |  1.0 | 58557.17821782 | BTCUSDT | 2024-09-02T23:59:59Z | 236.57100 | 117699.92821782 | -0.24972987 | 58557.17821782 | -28816.32520278 |     1 |  true |      59142.75 | -106.00275274 |  0.00432137 |   349.00078218 |   585.57178218 |  0.59009901 |   585.57178218 | -21136.11192278 | 39824.51845387 |  -138.20123896 |
|        765 | 2024-09-08T23:59:59Z |     57039.58 |   :profit-prct |       766 | -x4fGB | :short |  1.0 | 56474.83168317 | BTCUSDT | 2024-09-09T23:59:59Z | 228.15832 | 113514.41168317 | -0.24540849 | 56474.83168317 | -28479.73520594 |     1 |  true |      57039.58 | -105.41265373 |  0.00432137 |   336.58999683 |   564.74831683 |  0.59009901 |   564.74831683 | -20571.36360594 | 39487.92845703 |  -138.65272332 |
|        766 | 2024-09-09T23:59:59Z |     57643.48 |     :stop-prct |       767 | HzuxRM |  :long |  1.0 | 56513.21568627 | BTCUSDT | 2024-09-10T23:59:59Z | 230.57392 | 114156.69568627 | -0.25400866 | 56513.21568627 | -29840.57343967 |     1 | false |      57643.48 | -107.77343805 | -0.00860017 | -1360.83823373 | -1130.26431373 | -2.36078431 | -1130.26431373 | -21701.62791967 | 40848.76669076 |  -136.89001913 |
|        768 | 2024-09-11T23:59:59Z |     58134.02 |   :profit-prct |       769 | Rvql_p |  :long |  1.0 | 58715.36020000 | BTCUSDT | 2024-09-12T23:59:59Z | 232.53608 | 116849.38020000 | -0.24968729 | 58715.36020000 | -29491.76931967 |     1 |  true |      58134.02 | -107.17343805 |  0.00432137 |   348.80412000 |   581.34020000 |  0.60000000 |   581.34020000 | -21120.28771967 | 40499.96257076 |  -137.32632360 |
|        773 | 2024-09-16T23:59:59Z |     60311.99 |   :profit-prct |       774 | aBS1jO |  :long |  1.0 | 60915.10990000 | BTCUSDT | 2024-09-17T23:59:59Z | 241.24796 | 121227.09990000 | -0.24536592 | 60915.10990000 | -29129.89737967 |     1 |  true |      60311.99 | -106.57343805 |  0.00432137 |   361.87194000 |   603.11990000 |  0.60000000 |   603.11990000 | -20517.16781967 | 40138.09063076 |  -137.79001727 |
|        782 | 2024-09-25T23:59:59Z |     65172.72 |   :profit-prct |       783 | XNBsvO |  :long |  1.0 | 65824.44720000 | BTCUSDT | 2024-09-26T23:59:59Z | 260.69088 | 130997.16720000 | -0.24104454 | 65824.44720000 | -28738.86105967 |     1 |  true |      65172.72 | -105.97343805 |  0.00432137 |   391.03632000 |   651.72720000 |  0.60000000 |   651.72720000 | -19865.44061967 | 39747.05431076 |  -138.30420847 |
|        790 | 2024-10-03T23:59:59Z |     62090.14 | :trailing-stop |       793 | TrAzs8 | :short |  1.0 | 64078.78728937 | BTCUSDT | 2024-10-06T23:59:59Z | 248.36056 | 126168.92728937 | -0.25473619 | 64078.78728937 | -30975.86890904 |     3 | false |      62090.14 | -109.57627716 | -0.01369164 | -2237.00784937 | -1988.64728937 | -3.60283911 | -1988.64728937 | -21854.08790904 | 41984.06216013 |  -135.53796435 |
|        797 | 2024-10-10T23:59:59Z |     62534.12 |   :profit-prct |       798 | Y_5PVY |  :long |  1.0 | 63159.46120000 | BTCUSDT | 2024-10-11T23:59:59Z | 250.13648 | 125693.58120000 | -0.25041481 | 63159.46120000 | -30600.66418904 |     1 |  true |      62534.12 | -108.97627716 |  0.00432137 |   375.20472000 |   625.34120000 |  0.60000000 |   625.34120000 | -21228.74670904 | 41608.85744013 |  -135.97370692 |


:metrics

```
 {:nav {:equity-final -30600.664189044168, 
        :cum-pl -40600.66418904417, 
        :fee-total 19371.91748, 
        :max-drawdown 41984.06216013328, 
        :max-drawdown-prct 8023.616981165373}, 
  :roundtrip {:pf 1.0, 
              :win {:trades 69, :bars 83.0, :pl 15738.306601980188, :pl-mean 228.0914000286984, 
                    :trade-prct 53.48837209302326, :bar-avg 1.2028985507246377},
              :loss {:trades 60, :bars 83.0, :pl -56338.97079102435, :pl-mean -938.9828465170725,
                     :trade-prct 46.51162790697674, :bar-avg 1.3833333333333333}, 
              :all {:trades 129, :bars 166.0, :pl -40600.66418904417, :pl-mean nil, 
```


## for developers

### for development
 start a nrepl-connection to the dev project.
 in dev folder you will find plenty of namespaces to play with


*code linter*  `clj -M:lint`

*code formatter `clj -M:cljfmt-fix`

*unit tests* `clj -M:test`









